@model IEnumerable<AppUser>
@{
    ViewData["Title"] = "المستخدمين";
}

<h1>جميع المستخدمين</h1>
<a asp-action="Create" class="btn btn-secondary">انشاء مستخدم جديد</a>





@{
    // Assume userTypeDesc is a server-side variable
    string userTypeDesc = "admin"; // Replace with your actual logic to determine user type
}

<table id="classes" class="table table-striped table-bordered table-inverse table-responsive" style="font-size: 17px;">
    <thead>
        <tr>
            <th>اسم المستخدم</th>
            <th>الاسم الكامل</th>
            <th>نوع المستخدم</th>
            <th>تعديل</th>
            <th>حذف</th>
            <th></th>
        </tr>
    </thead>
</table>
<!-- Include SweetAlert CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">

<!-- Include SweetAlert JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.all.min.js"></script>

@section scripts{
    <script>
    $(document).ready(function () {
        var userTypeDesc = "@userTypeDesc";

        $("#classes").DataTable({
            "ajax": {
                "url": "@Url.Action("GetData", "Admin")",
                "type": "POST",
                "data": "{}",
                "datatype": "json"
            },
            "columns": [
                { "data": "userName" },
                { "data": "fullName" },
                { "data": "userTypeDesc" },
                {
                    "data": "id", "render": function (data, type, row) {
                        var editAndDeleteButtons = "";

                        // Check user type before rendering buttons
                        if (userTypeDesc.toLowerCase() == "admin") {
                            var editButton = "<a asp-action='Edit' class='btn btn-sm btn-primary' href='@Url.Action("Update", "Admin")/" + data + "' class='btn btn-warning'>تعديل</a>";

                            editAndDeleteButtons = editButton ;
                        }

                        return editAndDeleteButtons;
                    },

                    "orderable": true,
                    "searchable": true,
                    "width": "auto"
                },{
                    "data": "id", "render": function (data, type, row) {
                        var editAndDeleteButtons = "";
                        // Check user type before rendering buttons
                        if (userTypeDesc.toLowerCase() == "admin") {
        var deleteForm = "<form class='delete-form' action='@Url.Action("Delete", "Admin")' method='post'>" +
    "   <input type='hidden' name='id' value='" + data + "' />" +
    "   <button type='button' class='btn btn-sm btn-danger delete-button' onclick='confirmDelete(\"" + data + "\")'>حذف</button>" +
    "</form>";

                            editAndDeleteButtons =   deleteForm;
                        }

                        return editAndDeleteButtons;
                    },

                    "orderable": true,
                    "searchable": true,
                    "width": "auto"
                }
            ],
            "language": {
                "emptyTable": "لا يوجد بيانات يرجى الضغط على زر اضافة جديدة"
            }
        });
    });
    </script>



    <script>
        function confirmDelete(id) {
            Swal.fire({
                title: 'تأكيد الحذف',
                text: 'هل انت متأكد من حذف السجل؟',
                icon: 'تحذير',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'نعم حذف',
                cancelButtonText: 'تراجع'
            }).then((result) => {
                if (result.isConfirmed) {
                    // If the user confirms, call the Delete action with the user's id
                    $.post('@Url.Action("Delete", "Admin")', { id: id })
                        .done(function (response) {
                            // Handle success response if needed
                            if (response.success) {
                                // Optionally, you can reload the DataTable or perform any other action
                                Swal.fire('تم حذف المستخدم بنجاح', '', 'success');
                                $('#classes').DataTable().ajax.reload();
                            } else {
                                // Handle error response if needed
                                Swal.fire('لا يمكن حذف المستخدم', '', 'error');
                            }
                        })
                        .fail(function (xhr, status, error) {
                            // Handle failure if needed
                            Swal.fire('خطأ في عملية الحذف', '', 'error');
                        });
                }
            });
        }


    </script>
}
