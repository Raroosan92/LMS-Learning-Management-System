@model IEnumerable<AppUser>
@{
    ViewData["Title"] = "المستخدمين";
}

<h1>جميع المستخدمين</h1>
<a asp-action="Create" class="btn btn-secondary">انشاء مستخدم جديد</a>

<table class="table table-sm table-bordered">
    <tr>
        <th>اسم المستخدم</th>
        <th>الاسم الكامل</th>
        <th>نوع المستخدم</th>
        <th>تعديل</th>
        <th>حذف</th>
    </tr>
    @foreach (AppUser user in Model)
    {
        <tr>
            <td>@user.UserName</td>
            <td>@user.FullName</td>
            <td>@user.UserTypeDesc</td>
           @if (@user.UserTypeDesc.ToLower() !="admin")
           {

            <td>
                <a class="btn btn-sm btn-primary" asp-action="Update" asp-route-id="@user.Id">
                    تعديل
                </a>
            </td>
            <td>
                <form class="delete-form" asp-action="Delete" asp-route-id="@user.Id" method="post">
                    <button type="button" class="btn btn-sm btn-danger delete-button">
                        حذف
                    </button>
                    @*<button type="submit" class="btn btn-sm btn-danger">
                            حذف
                        </button>*@
                </form>
            </td>
           }
        </tr>
    }
</table>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // تحديد كل زر حذف باستخدام مُعرف فريد لكل زر
            var deleteButtons = document.querySelectorAll('.delete-button');

            deleteButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    // تنفيذ SweetAlert لرسالة تأكيد الحذف
                    Swal.fire({
                        title: 'هل أنت متأكد؟',
                        text: 'لن تكون قادرًا على التراجع بعد الحذف!',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'نعم، احذفه!',
                        cancelButtonText: 'إلغاء'
                    }).then((result) => {
                        // إذا تم النقر على زر التأكيد
                        if (result.isConfirmed) {
                            // تقديم النموذج للحذف
                            var deleteForm = button.closest('.delete-form');
                            deleteForm.submit();
                        }
                    });
                });
            });
        });
    </script>
}
