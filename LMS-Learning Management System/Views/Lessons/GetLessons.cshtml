@model LMS_Learning_Management_System.Models.VLessonCardsSubject

@{
    ViewData["Title"] = "عرض الدروس";
}

<style>
    body {
        /* Created with https://www.css-gradient.com */
        background: #161616;
    }

    h1 {
        color: #fff;
    }

    .lead {
        color: #aaa;
    }

    .wrapper {
        margin: 10vh;
    }

    .card {
        border: none;
        transition: all 500ms cubic-bezier(0.19, 1, 0.22, 1);
        overflow: hidden;
        border-radius: 20px;
        min-height: 176px;
        /*min-height: 450px;*/
        box-shadow: 0 0 12px 0 rgba(0, 0, 0, 0.2);
    }

    @@media (max-width: 768px) {
        .card {
            min-height: 172px;
            background-size: 100% !important;
            background-position: 0px 0% !important;
            background: no-repeat;
            /* min-height: 350px; */
        }
    }

    @@media (max-width: 420px) {
        .card {
            min-height: 300px;
        }
    }

    .card .card-has-bg {
        transition: all 500ms cubic-bezier(0.19, 1, 0.22, 1);
        background-size: 120%;
        background-repeat: no-repeat;
        background-position: center center;
    }

        .card .card-has-bg:before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: inherit;
            -webkit-filter: grayscale(1);
            -moz-filter: grayscale(100%);
            -ms-filter: grayscale(100%);
            -o-filter: grayscale(100%);
            filter: grayscale(100%);
        }

        .card .card-has-bg:hover {
            transform: scale(0.98);
            box-shadow: 0 0 5px -2px rgba(0, 0, 0, 0.3);
            background-size: 130%;
            transition: all 500ms cubic-bezier(0.19, 1, 0.22, 1);
        }

            .card .card-has-bg:hover .card-img-overlay {
                transition: all 800ms cubic-bezier(0.19, 1, 0.22, 1);
                background: #ffba21;
                background: linear-gradient(0deg, rgba(255, 186, 33, 0.5) 0%, #ffba21 100%);
            }

    .card .card-footer {
        background: none;
        border-top: none;
    }

        .card .card-footer .media img {
            border: solid 3px rgba(255, 255, 255, 0.3);
        }

    .card .card-title {
        font-weight: 800;
    }

    .card .card-meta {
        color: rgb(0 0 0);
        text-transform: uppercase;
        font-weight: bolder;
        letter-spacing: 0px;
        font-size: 18px;
    }

    .card .card-body {
        transition: all 500ms cubic-bezier(0.19, 1, 0.22, 1);
    }

    .card:hover {
        cursor: pointer;
        transition: all 800ms cubic-bezier(0.19, 1, 0.22, 1);
    }

        .card:hover .card-body {
            margin-top: 30px;
            transition: all 800ms ease-in;
        }

    .card .card-img-overlay {
        transition: all 800ms cubic-bezier(0.19, 1, 0.22, 1);
        background: #ffba21;
        background: linear-gradient(0deg, rgba(255, 186, 33, 0.3785889356) 0%, #ffba21 100%);
    }

    a {
        text-decoration: auto;
    }




    img {
        max-width: 100%;
    }

    .single-portfolio-item {
        margin-bottom: 30px;
    }

        .single-portfolio-item img {
            height: 100%;
            max-height: 300px;
            width: 100%;
            object-fit: cover;
        }

    .portfolio-menu {
        text-align: center;
    }

        .portfolio-menu ul {
            padding: 0;
            margin: 0;
            list-style: none;
        }

            .portfolio-menu ul li {
                display: inline-block;
                padding: 10px 30px;
                font-size: 18px;
                font-weight: 600;
                background: #f61069;
                color: #fff;
                border-radius: 3px;
                margin: 34px 4px;
                margin-bottom: 60px;
                cursor: pointer;
            }

                .portfolio-menu ul li.mixitup-control-active {
                    background: #3b4a4d;
                }
</style>

<!-- تضمين Bootstrap JS و jQuery -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6e6tf2h5KCzK5F/Y4XnJda2ZG99M6J5D0j8jM" crossorigin="anonymous"></script>


<section class="wrapper">
    <div class="container">
        <div class="row">
            <div class="col text-center mb-5">
                <h3 class="font-weight-bolder">الدروس المتاحة</h3>
                @*<p class="lead">Lorem ipsum dolor sit amet at enim hac integer volutpat maecenas pulvinar. </p>*@
            </div>
        </div>
        <div class="row">
            @{ if (Model.VLessonCardsSubject_Collection.Count() > 0)
                {

                    <section class="portfolio-area">
                        <div class="container">

                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="portfolio-menu">
                                        <ul>
                                            <li class="mixitup-control-active" data-filter="*">All</li>
                                            @foreach (VLessonCardsSubject lesson in Model.VLessonCardsSubject_Collection)
                                            {
                                                <li data-filter=".F_@lesson.SubjectId">@lesson.Subjectdesc</li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="row portfolio-list">
                                @foreach (VLessonCardsSubject lesson in Model.VLessonCardsSubject_Collection)
                                {
                                    if (lesson.TeacherId != null)
                                    {

                                        <div class="col-sm-4 mix single-portfolio-item  F_@lesson.SubjectId">
                                            <div class="col-sm-12 col-md-12 col-lg-12 mb-12">

                                                <div class="card text-dark card-has-bg click-col">

                                                    @*<div class="card text-dark card-has-bg click-col" style="background-image: url(../Images/depositphotos_39428483-stock-photo-lesson.jpg) !important; background-position: 0px 0px; background-size: 100% !important; background: no-repeat;">*@
                                                    <div class="card-img-overlay d-flex flex-column">

                                                        <a class="text-dark" href="ShowLesson/@lesson.Id">
                                                            <div class="card-body">
                                                                <small class="card-meta mb-2">@lesson.Classdesc</small>
                                                                <br />
                                                                <small class="card-meta mb-2">@lesson.Subjectdesc</small>
                                                                <br />
                                                                <br />
                                                                <h4 class="card-title mt-0 ">
                                                                    @lesson.Name
                                                                </h4>
                                                            </div>
                                                        </a>


                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {

                                        <a class="text-dark" href="#" onclick="openTeacherModal('teacherModal',@lesson.SubjectId,@lesson.ClassId,@lesson.CardNo)">
                                            <div class="col-sm-4 mix single-portfolio-item  F_@lesson.SubjectId">
                                                <div class="col-sm-12 col-md-12 col-lg-12 mb-12">

                                                    <div class="card text-dark card-has-bg click-col">

                                                        @*<div class="card text-dark card-has-bg click-col" style="background-image: url(../Images/depositphotos_39428483-stock-photo-lesson.jpg) !important; background-position: 0px 0px; background-size: 100% !important; background: no-repeat;">*@
                                                        <div class="card-img-overlay d-flex flex-column">

                                                            <div class="card-body">
                                                                <small class="card-meta mb-2">@lesson.Classdesc</small>
                                                                <br />
                                                                <small class="card-meta mb-2">@lesson.Subjectdesc</small>
                                                                <br />
                                                                <br />
                                                                <h4 class="card-title mt-0 ">
                                                                    اختر المعلم
                                                                </h4>
                                                            </div>
                                                            <!-- Modal -->
                                                            <div class="modal fade" id="teacherModal" tabindex="-1" role="dialog" aria-labelledby="teacherModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog" role="document">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title" id="teacherModalLabel">اختيار المعلم</h5>
                                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style=" background: transparent; color: white; border: transparent; font-size: 27px; }">
                                                                                <span aria-hidden="true">&times;</span>
                                                                            </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <!-- DropDownList -->
                                                                            <label for="selectedItem">اختر العنصر:</label>

                                                                            @Html.DropDownList("selectedItem", new SelectList(Model.TeacherInfo_Collection.Where(r=>r.ClassId== @lesson.ClassId && r.SubjectId== @lesson.SubjectId), "Id", "FullName"), "-- اختر --", new { @class = "form-control" })

                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">إغلاق</button>
                                                                            <button type="button" class="btn btn-primary" id="saveTeacherSelection">حفظ</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>


                                        </a>

                                    }
                                }




                              
                            </div>
                        </div>
                    </section>


                }
                else
                {
                    <h4>لا يوجد دروس مسجلة حاليا</h4>
                }
            }






        </div>

    </div>
</section>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mixitup/3.3.1/mixitup.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script>
    var Subject_id;
    var Class_id;
    var Card_No;
    function openTeacherModal(modalId, SubjectId, ClassId, CardNo) {
        // يمكنك قم بتنفيذ أي كود إضافي هنا قبل فتح النموذج إذا لزم الأمر
        $("#" + modalId).modal("show");
       Subject_id = SubjectId;
       Class_id = ClassId;
       Card_No = CardNo;
    }
    $(document).ready(function () {
        var mixer = mixitup('.portfolio-list');

        // كود jQuery للقيام بشيء ما عندما يتم اختيار المعلم
        // يمكنك استخدام AJAX لإرسال القيمة إلى الخادم هنا

        // على سبيل المثال:
        $("#saveTeacherSelection").on("click", function () {

            var selectedTeacher = $("#selectedItem").val(); // افتراضياً، قم بتغيير "teacherDropdown" بالعنصر الذي تستخدمه لاختيار المعلم
            if (selectedTeacher == "") {
                alert("يرجى اختيار معلم.");
                return;
            }
            // إذا كنت تستخدم ASP.NET Core، يمكنك إرسال القيمة باستخدام $.post
            $.post("/Lessons/AssignTeacher", { teacherId: selectedTeacher, Card_No: Card_No, Subject_id: Subject_id, Class_id: Class_id },
                function (data) {
                // قم بمعالجة الاستجابة من الخادم إذا لزم الأمر
                    alert(data.message);
                    // قد تكون رسالة نجاح أو أي نوع آخر من الرسائل
                    window.location.reload();
            });

            // يمكنك استخدام $.ajax أو أي طريقة أخرى حسب احتياجاتك
        });
    });

</script>
